<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>LiveScore Ultimate</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0b0f1a; --card:#12172a; --accent:#3b82f6; --text:#e5e7eb; --muted:#9ca3af; --live:red;
}
*{box-sizing:border-box}
body{margin:0;font-family:Inter,system-ui;background:radial-gradient(circle at top,#111827,#020617);color:var(--text);transition:0.3s}
header{padding:12px;display:grid;gap:8px;border-bottom:1px solid #1f2937;background:#020617}
header input, header select{background:#020617;border:1px solid #1f2937;color:#fff;padding:10px;border-radius:10px;outline:none}
main{display:grid;grid-template-columns:380px 1fr;height:calc(100vh - 110px)}
aside{overflow-y:auto;padding:10px;border-right:1px solid #1f2937}
.match{background:linear-gradient(145deg,#111827,#020617);border:1px solid #1f2937;border-radius:14px;padding:10px;margin-bottom:10px;cursor:pointer;transition:.15s;position:relative}
.match:hover{transform:translateY(-2px);border-color:var(--accent)}
.live-dot{width:10px;height:10px;background:var(--live);border-radius:50%;display:inline-block;margin-right:6px;animation:pulse 1s infinite alternate;}
@keyframes pulse{0%{opacity:0.6;}100%{opacity:1;}}
.row{display:grid;grid-template-columns:1fr auto 1fr;align-items:center}
.team{display:flex;align-items:center;gap:8px;font-size:14px}
.team.right{justify-content:flex-end}
.team img{width:24px;height:24px}
.score{font-weight:700;font-size:15px;color:#fff;transition:0.3s}
.score.flash{animation:flashScore 0.5s;}
@keyframes flashScore{0%{color:#fff;}50%{color:#3b82f6;}100%{color:#fff;}}
.meta-score{position:absolute;top:8px;right:8px;background:var(--accent);padding:2px 6px;border-radius:6px;font-size:12px;font-weight:600}
section{padding:14px;overflow-y:auto}
#title{font-size:20px;font-weight:700;margin-bottom:10px;display:flex;align-items:center;justify-content:space-between}
#tabs{display:flex;gap:8px;margin-bottom:12px}
#tabs button{background:#020617;border:1px solid #1f2937;color:#fff;padding:8px 12px;border-radius:999px;cursor:pointer}
#tabs button:hover{background:var(--accent)}
.player{display:flex;align-items:center;gap:10px;padding:8px;background:var(--card);border-radius:12px;margin-bottom:6px}
.player img{width:36px;height:36px;border-radius:50%}
.stat{display:flex;justify-content:space-between;background:var(--card);padding:8px;border-radius:10px;margin-bottom:6px}
.event{display:flex;align-items:center;gap:6px;padding:4px;background:var(--card);border-radius:6px;margin-bottom:2px;font-size:14px}
.event span{font-weight:600}
#loader{position:fixed;inset:0;display:none;background:#020617cc;align-items:center;justify-content:center;z-index:999;font-size:18px}
#darkToggle{cursor:pointer;padding:6px 10px;background:var(--card);border-radius:8px;border:none;color:#fff}
.ad-banner{background:#1f2937;padding:6px;margin:10px 0;text-align:center;border-radius:8px;cursor:pointer;transition:.2s}
.ad-banner:hover{background:#3b82f6;color:#fff}
.admin-modal{position:fixed;inset:0;background:#020617cc;display:none;align-items:center;justify-content:center;z-index:1000}
.admin-content{background:var(--card);padding:20px;border-radius:12px;width:320px}
button.view-more{background:var(--accent);border:none;padding:6px 12px;color:#fff;border-radius:8px;margin-top:6px;cursor:pointer}
@media(max-width:900px){main{grid-template-columns:1fr}}
</style>
</head>
<body>

<div id="loader">Loadingâ€¦</div>

<header>
<div style="display:flex;gap:8px;align-items:center">
<input id="search" placeholder="Search club / admin">
<button id="darkToggle">ðŸŒ™</button>
</div>
<select id="league">
  <option value="">All Leagues</option>
  <option value="39">Premier League</option>
  <option value="140">La Liga</option>
  <option value="135">Serie A</option>
  <option value="78">Bundesliga</option>
  <option value="61">Ligue 1</option>
</select>
</header>

<main>
<aside id="matches"></aside>
<section>
<h2 id="title">Select a match</h2>
<div id="tabs" style="display:none">
<button onclick="tab('lineups')">Lineups</button>
<button onclick="tab('events')">Events</button>
<button onclick="tab('stats')">Stats</button>
<button onclick="tab('h2h')">H2H</button>
<button onclick="tab('table')">Table</button>
</div>
<div id="content"></div>
</section>
</main>

<div class="admin-modal" id="adminModal">
  <div class="admin-content">
    <h3>Admin Panel</h3>
    <input type="password" id="adminPass" placeholder="Password" style="width:100%;padding:6px;margin-bottom:8px;border-radius:6px;border:none">
    <button onclick="loginAdmin()" style="width:100%;padding:6px;background:var(--accent);border:none;color:#fff;border-radius:6px">Login</button>
    <div id="adminActions" style="display:none;margin-top:12px">
      <h4>Add Ad</h4>
      <input type="text" id="adLink" placeholder="Ad Image / YouTube Link" style="width:100%;padding:6px;margin-bottom:6px;border-radius:6px;border:none">
      <input type="text" id="adRedirect" placeholder="Redirect Link" style="width:100%;padding:6px;margin-bottom:6px;border-radius:6px;border:none">
      <button onclick="addAd()" style="width:100%;padding:6px;background:var(--accent);border:none;color:#fff;border-radius:6px">Add</button>
      <p style="margin-top:6px;font-size:12px;color:var(--muted)">Current Ads: <span id="adCount">0</span></p>
    </div>
  </div>
</div>

<script>
const API="https://YOUR-BACKEND-URL.onrender.com/api";
const loader=document.getElementById("loader");
let match=null;
let ads=[];
let adIndex=0;

// DARK / LIGHT MODE
let dark=true;
document.getElementById("darkToggle").onclick=()=>{
  dark=!dark;
  document.body.style.background=dark?"radial-gradient(circle at top,#111827,#020617)":"#fff";
  document.body.style.color=dark?"#e5e7eb":"#111";
}

// ADMIN HIDDEN
const searchBox=document.getElementById("search");
searchBox.addEventListener("keyup",e=>{
  if(e.target.value==="Akinpepe@100"){
    document.getElementById("adminModal").style.display="flex";
  }
});
function loginAdmin(){
  const pass=document.getElementById("adminPass").value;
  if(pass==="Akinpepe100"){
    document.getElementById("adminActions").style.display="block";
  }else alert("Wrong password");
}
function addAd(){
  const link=document.getElementById("adLink").value;
  const redirect=document.getElementById("adRedirect").value;
  if(link&&redirect){
    ads.push({link,redirect});
    document.getElementById("adCount").innerText=ads.length;
    document.getElementById("adLink").value="";
    document.getElementById("adRedirect").value="";
    alert("Ad added!");
  }
}

// API helper
async function api(u){
  loader.style.display="flex";
  const r=await fetch(API+u);
  const d=await r.json();
  loader.style.display="none";
  return d.response||[];
}

// MATCH HTML with minute + injury time
function matchHTML(f,live=false){
  let elapsed=f.fixture.status.elapsed || 0;
  if(f.fixture.status.extra) elapsed += "+" + f.fixture.status.extra;
  return `<div class="match" onclick="openMatch(${f.fixture.id})">
    ${live?'<span class="live-dot"></span>LIVE '+elapsed+"' ":""}
    <div class="row">
      <div class="team"><img src="${f.teams.home.logo}">${f.teams.home.name}</div>
      <div class="score" id="score-${f.fixture.id}">${f.goals.home??"-"} : ${f.goals.away??"-"} <span class="meta-score">8</span></div>
      <div class="team right">${f.teams.away.name}<img src="${f.teams.away.logo}"></div>
    </div>
  </div>`;
}

// GROUP BY LEAGUE
function groupByLeague(matches){
  const obj={};
  matches.forEach(m=>{
    if(!obj[m.league.name]) obj[m.league.name]=[];
    obj[m.league.name].push(m);
  });
  return obj;
}

// LOAD FIXTURES
async function loadFixtures(){
  const league=document.getElementById("league").value;
  const date=new Date().toISOString().split("T")[0];
  let u=`/fixtures?date=${date}`;
  if(league) u+=`&league=${league}`;
  const data=await api(u);

  const box=document.getElementById("matches");
  box.innerHTML="";

  const live=data.filter(m=>m.fixture.status.short==="LIVE");
  const others=data.filter(m=>m.fixture.status.short!=="LIVE");

  if(live.length){
    box.innerHTML="<h4>Live Matches</h4>";
    live.forEach(f=>box.innerHTML+=matchHTML(f,true));
    box.innerHTML+='<button class="view-more" onclick="alert(\'All live matches\')">View More</button>';
  }

  const grouped=groupByLeague(others);
  for(const l in grouped){
    box.innerHTML+=`<h4>${l}</h4>`;
    grouped[l].forEach(f=>box.innerHTML+=matchHTML(f,false));
    box.innerHTML+='<button class="view-more" onclick="alert(\'View more for league '+l+'\')">View More</button>';
  }
}

// OPEN MATCH DETAILS
async function openMatch(id){
  const d=await api(`/fixtures?id=${id}`);
  match=d[0];
  document.getElementById("tabs").style.display="flex";
  document.getElementById("title").innerText=match.teams.home.name+" vs "+match.teams.away.name;
  tab("lineups");
}

// TABS WITH EVENT ICONS
async function tab(t){
  const c=document.getElementById("content");
  c.innerHTML="";
  if(!match) return;
  if(t==="lineups"){
    const d=await api(`/fixtures/lineups?fixture=${match.fixture.id}`);
    d.forEach(team=>{
      c.innerHTML+=`<h4>${team.team.name}</h4>`;
      team.startXI.forEach(p=>c.innerHTML+=`<div class="player"><img src="${p.player.photo}">${p.player.name} (${p.player.pos})</div>`);
    });
  }
  if(t==="events"){
    const d=await api(`/fixtures/events?fixture=${match.fixture.id}`);
    d.forEach(e=>{
      let icon="";
      if(e.detail.toLowerCase().includes("goal")) icon="âš½";
      else if(e.detail.toLowerCase().includes("yellow")) icon="ðŸŸ¨";
      else if(e.detail.toLowerCase().includes("red")) icon="ðŸŸ¥";
      else if(e.detail.toLowerCase().includes("substitution")) icon="ðŸ”„";
      c.innerHTML+=`<div class="event"><span>${e.time.elapsed}'</span> ${icon} ${e.detail}</div>`;
    });
  }
  if(t==="stats"){
    const d=await api(`/fixtures/statistics?fixture=${match.fixture.id}`);
    d[0].statistics.forEach((s,i)=>c.innerHTML+=`<div class="stat"><span>${s.value??0}</span><span>${s.type}</span><span>${d[1].statistics[i].value??0}</span></div>`);
  }
}

// AUTO-REFRESH LIVE MATCHES EVERY 15 SECONDS + animate score change
setInterval(async () => {
  const date = new Date().toISOString().split("T")[0];
  let u = `/fixtures?date=${date}`;
  const data = await api(u);
  const live = data.filter(m => m.fixture.status.short === "LIVE");
  if(live.length){
    const box = document.getElementById("matches");
    live.forEach(f=>{
      const scoreEl=document.getElementById(`score-${f.fixture.id}`);
      if(scoreEl && scoreEl.innerText !== `${f.goals.home??"-"} : ${f.goals.away??"-"} 8`){
        scoreEl.innerText=`${f.goals.home??"-"} : ${f.goals.away??"-"} 8`;
        scoreEl.classList.add("flash");
        setTimeout(()=>scoreEl.classList.remove("flash"),500);
      }
    });
  }
}, 15000);

// ROTATING ADS + POPUP every 5 mins
function showAd(){
  if(!ads.length) return;
  const a=ads[adIndex];
  const banner=document.createElement("div");
  banner.className="ad-banner";
  banner.innerHTML=`${a.link.includes("youtube")?'<iframe width="100%" height="80" src="'+a.link+'" frameborder="0" allowfullscreen></iframe>':'<img src="'+a.link+'" style="max-width:100%;border-radius:6px">'}`;
  banner.onclick=()=>window.open(a.redirect,"_blank");
  document.getElementById("matches").appendChild(banner);
  adIndex=(adIndex+1)%ads.length;
}
setInterval(showAd,300000); // every 5 mins

document.getElementById("league").onchange=loadFixtures;
loadFixtures();
</script>
</body>
</html>
